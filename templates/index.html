<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calorie Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h1 class="text-center mb-4">üçΩÔ∏è Calorie Tracker</h1>

    <div class="card shadow-sm p-4 mb-4">
      <form method="POST">
        <div class="row g-3 align-items-end">
          <div class="col-md-5">
            <label for="name" class="form-label">Select Meal</label>
            <select class="form-select" name="name" required>
              {% for meal, cal in meals.items() %}
                <option value="{{ meal }}">{{ meal }} ({{ cal }} cal)</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-3">
            <label for="quantity" class="form-label">Quantity</label>
            <input type="number" class="form-control" name="quantity" min="1" value="1" required>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Add Meal</button>
          </div>
        </div>
      </form>
    </div>

    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">Logged Meals</h4>
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>Meal</th>
            <th>Calories</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for meal in all_meals %}
          <tr>
            <td>{{ meal.name }}</td>
            <td>{{ meal.calories }}</td>
            <td>{{ meal.date.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
              <a href="{{ url_for('edit', meal_id=meal.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
              <a href="{{ url_for('delete', meal_id=meal.id) }}" class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('Are you sure?')">Delete</a>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="text-center">No meals added yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="card shadow-sm p-4 mb-5">
      <h4 class="mb-3">Calories Over Time</h4>
      <canvas id="calorieChart" height="100"></canvas>
    </div>
  </div>

  <script>
    const ctx = document.getElementById('calorieChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: {{ chart_labels|safe }},
        datasets: [{
          label: 'Calories per Meal',
          data: {{ chart_data|safe }},
          backgroundColor: '#0d6efd'
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
  </script>
</body>
</html>
